this dispute emerges from a web of state and federal litigation over liability for damages and defense costs in certain environmental tort suits.the appeal before us concerns two cases that mirror each other an action for damages that the appellants brought in federal court and a declaratory judgment action that the appellee brought in state court,which appellants later removed to federal court.the district court declined to entertain these actions,by dismissing the former and remanding the latter,in light of a related third action that had been pending for several years in state court.we must examine the propriety of this decision.
considering the particular circumstances of this case,we conclude that the district court had discretion under wilton seven falls,and brillhart excess ins.of,to remand the declaratory judgment action,and that the action for damages fell within the scope of colorado river water conservation dist.united states.we therefore affirm.
background 
vulcan materials company vulcan manufactures a solvent called perchloroethylene persec between the and the,street.street distributed persec.during this time,vulcan named street as an additional insured under its insurance policies,including an excess liability coverage policy that transport insurance company transport issued to vulcan in the policy.since the,a number of lawsuits have been filed against vulcan and street alleging damage caused by the sale,distribution,use or handling of persec collectively the tort actions.street and vulcan separately defended these actions.since,the companies and their insurers have engaged in an ongoing dispute over liability for damages and defense costs in the tort actions.
a.the vulcan action 
in january,transport filed a lawsuit in the los angeles county superior court seeking a declaration of its coverage obligations to vulcan under four consecutive insurance policies,including the policy.in august,two other insurance carriers filed similar actions against vulcan and its primary insurers in the same court.in january,these cases were consolidated into a single complex proceeding the vulcan action in los angeles county superior court.
in the meantime,street sought reimbursement from vulcan for defense costs and damages in the tort actions.in february,street and its insurer,national union fire insurance company of pittsburgh,pa national union,filed a breach of contract and indemnity action against vulcan in the northern district of illinois to recover these amounts the illinois action.see street vulcan materials,cir.we refer to street and national union collectively as union.in the illinois action,union claimed that vulcan was liable to street based on an indemnification provision in the parties distribution contract.id.at.
in april,vulcan filed the state court equivalent of a complaint against union in the vulcan action vulcan hoped to resolve all indemnification claims related to the tort actions in a single proceeding.vulcan complaint against union mirrored the illinois action in addition,vulcan sought a declaration that its insurers were liable for any obligation vulcan owed to union.
with the same claims pending in an illinois federal court and a california state court,vulcan and union waged a battle to determine which court would hear the claims between them the state court agreed to stay the claims against union in the vulcan action and decide them at a later stage of the litigation.
at no point did transport intervene in the illinois action,and prior to the cases on appeal,no claims had been filed between street and transport in the vulcan action or elsewhere nevertheless,the parties and the court were aware of the dormant claims between street and transport.in a january supplemental brief on preliminary issues in the vulcan action,national union argued that the superior court initial determinations would not apply to any of street potential claims under the policy because street was in a different position than vulcan.
at a march status hearing,the parties discussed street status as an additional insured under the policy.street indicated that it had made a demand for coverage under the policy,which transport had rejected,but it had not yet filed any claims against transport in court because the underlying tort actions were still pending.street argued that any coverage decisions regarding vulcan should not apply to street because street was covered by different primary insurance policies,was in a different position than vulcan in relation to the tort actions and had not participated in discovery or case management related to transport claims against vulcan.the state court postponed this issue,stating that it would decide later whether street would be bound by a decision regarding vulcan coverage under the policy.
in april,the state court issued an order in the vulcan action deciding three preliminary legal issues concerning the scope of transport liability to vulcan under the policy.the court determined the scope of transport duty to defend under the policy,interpreted the phrase underlying insurance,and addressed whether horizontal exhaustion applied to vulcan claims under the policy.the court interpretation of the policy favored transport position,so vulcan appealed the decision to the california court of appeals.
b.the federal and removed actions 
on august,while vulcan appeal was pending,union filed an action for damages against transport the federal action in the central district of california.in the federal action,union asserted claims for breach of contract,subrogation,equitable contribution and unjust enrichment under the policy,seeking damages and defense costs incurred in the tort actions.
a few days later,on august,union and vulcan agreed to dismiss the claims between them in the vulcan action.as of that date,street was no longer a party to the vulcan action.upon learning that union had filed the federal action and had been voluntarily dismissed from the vulcan action,the state court judge urged transport to either amend its complaint to name union as defendants in the vulcan action or file a separate action against union that could be consolidated with the vulcan action.
on november,transport filed a declaratory judgment action against street and national union in los angeles county superior court the removed action.transport action mirrors the federal action.transport also filed in the state court a notice stating that its declaratory judgment action is related to the vulcan action.
on november,transport filed in the district court a motion to stay or dismiss the federal action in light of the vulcan action and the removed action,which were then separately pending in state court.on november,before the district court ruled on transport motion and before the state court consolidated the removed action with the vulcan action,street removed transport action to federal court.a few weeks later,the state court entered an order relating the cases in the event that the removed action was remanded to state court.
the federal action and the removed action were assigned to the same judge,and transport quickly moved for remand of the removed action as well as dismissal of the federal action.on february,the district court granted both of transport motions.noting the similarities between the two actions in federal court and the vulcan action,the district court exercised its discretion under the declaratory judgment act to remand the removed action,and the court dismissed the federal action pursuant to the principles announced in colorado river water conservation dist.united states.based on the rooker feldman doctrine,the court also concluded that it lacked jurisdiction to decide any issues addressed in the state court april order in the vulcan action.
street and national union timely appealed the remand and the dismissal,and this court consolidated the appeals.both the remand and the dismissal are appealable decisions.see quackenbush allstate ins.the district court had jurisdiction under a,based on diversity of citizenship,and we have jurisdiction to consider the appeals under.
transport motion to dismiss 
before examining the district court decision,we must address a preliminary question whether to dismiss union appeal of the remand order.transport argues that union waived their right to the removed action to federal court when they filed a in the vulcan action.in some cases,a defendant may waive the initial right to removal if the defendant takes actions in state court that manifest his or her intent to have the matter adjudicated there.resolution trust bayside developers,cir.transport cites no authority extending this waiver principle to the appeal of a remand order,but even if we extended it to this case,transport argument would fail.a waiver of the right of removal must be clear and unequivocal.id.internal quotation marks omitted.here,there is no evidence that union intended to waive their right to appeal the district court order.union merely sought to preserve their claims in state court pending the outcome of this appeal they have indicated at every step of the way that they intended to pursue the appeal.
further,street filings do not deprive us of jurisdiction to review the remand order.the case is not moot because an actual controversy still exists between transport and union.see alvarez smith.for these reasons,we deny transport motion to partially dismiss the appeal,and we review the district court decision in its entirety.
standard of review 
we review application of the rooker feldman doctrine de novo.carmona carmona,cir.we review the district court decision to refrain from deciding a declaratory judgment action for abuse of discretion.wilton seven falls.we also review a district court decision to stay or dismiss an action based on colorado river for abuse of discretion however,this standard is stricter than the flexible abuse of discretion standard used in other areas of law because discretion must be exercised within the narrow and specific limits prescribed by the colorado river doctrine.holder holder,cir internal quotation marks omitted.thus,w hether the facts of a particular case conform to the requirements for a colorado river stay or dismissal is a question of law which we review de novo.smith cent.water conservation,cir.
although the parties have filed a number of motions asking us to consider recent developments in the state court proceedings,we examine the district court decision based on the state of affairs at the time of that decision.we judge the propriety of the district court assumption of jurisdiction in a declaratory judgment action as of the time of filing,not the time of appeal.emp rs reinsurance karussos,cir,overruled in part on other grounds by gov t emps.ins.dizol,cir en banc.although we have not explicitly addressed the scope of review for a grant of a colorado river motion,when reviewing the district court denial of a colorado river motion to stay or dismiss,we previously have held that we consider only the facts.smith,at.we see no reason to adopt a different rule in this case.as we noted in smith,d ocuments or facts not presented to the district court are not part of the record on appeal.id.quoting united states.elias,cir.we therefore deny the parties motions requesting judicial notice,motions to supplement the record and motions to file supplemental briefs because these motions relate to events that occurred after the district court remanded the removed action and dismissed the federal action.we proceed by reviewing the district court decision in light of the circumstances at the time of that decision.
rooker feldman 
the district court concluded that rooker feldman prohibited the court from considering any of union allegations that were contrary to findings in the superior court april order we disagree.the supreme court has confined rooker feldman to the narrow range of cases brought by losers complaining of injuries caused by judgments rendered before the district court proceedings commenced and inviting district court review and rejection of those judgments.exxon mobil saudi basic indus.
here,there is simply no state court judgment from which union seek relief.vacation,clark,cir emphasis added.even if we considered the april order a judgment,the order did not apply to union.rooker feldman therefore does not deprive the district court of jurisdiction over the claims in the federal action or the removed action.see johnson de grandy,noting that rooker feldman does not apply to claims that have not yet been litigated carmona,at concluding that rooker feldman did not apply to a claim against a new party even though the claim raise d the same legal issue as claims against prior parties.
discretion over entertaining the actions 
having determined that the district court had jurisdiction to consider the claims in the federal action and the removed action,we must now decide whether the district court had discretion to refrain from exercising that jurisdiction.although courts usually avoid duplicative litigation when similar cases are pending in two different federal courts,g enerally,as between state and federal courts,the rule is that the pendency of an action in the state court is no bar to proceedings concerning the same matter in a federal court.colorado river,at emphasis added internal quotation marks omitted.in this case,the district court relied on two doctrines that provide exceptions to the general rule concerning concurrent state and federal proceedings.the court remanded the removed action based on the doctrine,and it dismissed the federal action pursuant to colorado river.we consider these doctrines in turn.
the declaratory judgment act uses permissive language.see a stating that federal courts may declare the rights and other legal relations of any interested party in a declaratory judgment action emphasis added.based on the permissive nature of the declaratory judgment act,in brillhart excess insurance of america,the supreme court held that a district court has discretion to dismiss a federal declaratory judgment action when the questions in controversy can better be settled in a pending state court proceeding.id.at.the court reaffirmed this principle in wilton,holding that a district court may decline to entertain a federal declaratory judgment action when state court proceedings present opportunity for ventilation of the same state law issues.at.the court has not yet delineated the outer boundaries of the doctrine,but we have allowed district courts broad discretion as long as it furthers the declaratory judgment act purpose of enhancing judicial economy and cooperative federalism,dizol,at.
in brillhart,the court articulated three factors that courts should consider when examining the propriety of entertaining a declaratory judgment action avoiding needless determination of state law issues discouraging forum shopping and avoiding duplicative litigation.see dizol,at.although courts may also consider a number of other factors,the three brillhart factors remain the philosophic touchstone for the analysis,and they served as the basis for the district court decision in this case.the district court found that the claims in the removed action involved state law issues that had been or could be considered in the vulcan action that street had engaged in forum shopping by filing the federal action and removing the removed action and,most significantly,that the removed action was duplicative of the vulcan action.
determination of state law issues 
there is no question that retaining jurisdiction over the removed action would have required the district court to decide basic issues of state law.in prior cases,we have recognized that needless determination of state law issues alone may support remand.see huth hartford ins.of the midwest,cir affirming remand of a declaratory judgment action to avoid needless determination of state law issues even in the absence of a similar state court proceeding.we do not end our analysis here,however,because the presence of the federal action raises other considerations in this case.
forum shopping 
union argue that the district court abused its discretion by remanding the removed action instead of staying or consolidating it with the federal action because transport removed action was reactive.we have instructed that federal courts should generally decline to entertain reactive declaratory actions.dizol,at.for example,we held that when an insurer filed a declaratory judgment action in federal court during the pendency of a state court action presenting the same issues of state law,and the insurer did so merely to obtain a tactical advantage from litigating in a federal forum,the defensive or reactive nature of the insurer action warranted dismissal.continental cas.robsac,cir,overruled in part on other grounds by dizol,at.
the declaratory judgment action in robsac was an archetype of reactive litigation,id.at,but this case is distinguishable from robsac.in robsac,it was clear that the insurance company was merely for strategic purposes,and all of the brillhart factors pointed in the same direction.see id.at.here,transport concedes that it filed the removed action in response to the federal action,but it did so not merely to seek a favorable forum but also to seek a forum that could resolve all issues related to the policy in one comprehensive proceeding.additionally,in contrast to robsac,both parties appear to have engaged in some defensive maneuvering or procedural fencing.
the mere fact that the district court decision preserved the removed action instead of the federal action is of no consequence.although courts generally give preference to the case among concurrent federal court proceedings,this is not a rigid or inflexible rule to be mechanically applied,but rather one that yields to the dictates of sound judicial administration.pacesetter,medtronic,cir.timing is only one consideration when deciding whether to entertain a declaratory judgment action,and the factors sometimes compel a court to decline to entertain an action in favor of a action.see wilton,at affirming dismissal of a federal action in light of a state action huth,at affirming dismissal of an declaratory action but remanding a one.
duplicative litigation 
if the removed action had been the only case pending before the district court,there would be no question that the court properly remanded the case.retaining jurisdiction over the removed action would have required the district court to address the same issues of state law and policy interpretation that the state court had been grappling with for several years in the vulcan action,leading to duplicative litigation.in this case,however,the district court had to consider not only the removed action,which requests only declaratory relief,but also the federal action,which includes claims for damages.
we have held that if the same action contains claims for both monetary and declaratory relief,the district court should not,as a general rule,remand or decline to entertain the claim for declaratory relief.snodgrass provident life accident ins,cir internal quotation marks omitted.snodgrass raises two considerations significant to this case.first,the discretionary standard does not apply to actions for damages,and the court may not rely solely on this standard to dispose of claims for damages.in snodgrass,the district court on its own motion used its broad discretion under the declaratory judgment act to remand the entire case even though the essence of the case was a suit for damages.id.we reversed because c laims that exist independent of the request for a declaration are not subject to the declaratory judgment act discretionary jurisdictional rule but instead invoke the virtually unflagging obligation of the district court to hear jurisdictionally sufficient claims.id.quoting colorado river,at 
second,if the district court must exercise jurisdiction over claims for damages,the court should also retain similar claims for declaratory relief to avoid piecemeal litigation.given the usual obligation to exercise jurisdiction over claims for damages,r emanding only the declaratory component of an action will frequently produce piecemeal litigation,a result which the declaratory judgment act was intended to avoid,rather than promote.id.citations omitted see also dizol,at if a federal court is required to determine major issues of state law because of the existence of claims,the declaratory action should be retained to avoid piecemeal litigation.
although this case involves two separate actions,while snodgrass involved a single action with claims for both monetary and declaratory relief,the same basic principles apply.if the district court must exercise jurisdiction over the federal action,then the court should also retain jurisdiction over the removed action.the two actions involve identical issues,so remanding the removed action while maintaining the federal action would not serve the goals of avoiding duplicative litigation and needless determination of state law issues.chamberlain allstate ins,cir noting that refusing to issue a declaratory judgment may result in piecemeal litigation if the court retains jurisdiction over other claims in short,we conclude the district court did not abuse its discretion by remanding the removed action as long as colorado river authorized dismissal of the federal action.we now turn to colorado river.
colorado river 
as we noted above,courts do not possess the same discretion over actions for damages that they possess over declaratory judgment actions.see wilton,at.indeed,when it comes to actions for damages,such as the federal action,federal courts possess a virtually unflagging obligation to exercise the jurisdiction given them.colorado river,u.at.only in rare cases will the presence of a concurrent state proceeding permit the district court to dismiss a concurrent federal suit for reasons of wise judicial administration.id.at.
the supreme court recognized such a rare case in colorado river.there,the federal government brought suit against water users in federal court,seeking a declaration of water rights in certain rivers and tributaries in colorado.id.at.colorado had previously established seven water districts to adjudicate water rights in ongoing state court proceedings.id.at.after the government filed its suit in federal court,several of the defendants in that case filed an application joining the government as a party in the state court proceedings for the relevant water district.id.at.the district court then dismissed the government federal suit in light of the ongoing state court proceedings.on appeal,the supreme court held that although none of the traditional abstention doctrines applied,considerations of w ise judicial administration,giving regard to conservation of judicial resources and comprehensive disposition of litigation,justified dismissal of the federal suit.id.at alternation in original internal quotation marks omitted.the court noted several factors that supported dismissal,relying particularly on the highly interdependent relationship between the claims in the state and federal proceedings and the federal policy,embodied in the mccarran amendment,of avoiding piecemeal adjudication of water rights.id.at.
the court has carefully limited colorado river,emphasizing that courts may refrain from deciding an action for damages only in exceptional cases,and only the clearest of justifications support dismissal.id.at.in moses cone memorial hospital mercury construction,the court held that no exceptional circumstances justified the district court stay of an action to compel arbitration under the federal arbitration act.the court noted that although a state court suit involving the underlying claims was pending when the federal suit was filed,the federal suit did not increase the risk of piecemeal litigation substantial progress had already been made in the federal suit federal law provided the rule of decision on the merits of the case and there was substantial doubt as to whether the state court could issue the remedy sought in federal court.id.at.
to decide whether a particular case presents the exceptional circumstances that warrant a colorado river stay or dismissal,the district court must carefully consider both the obligation to exercise jurisdiction and the combination of factors counseling against that exercise.colorado river,at.drawing from colorado river,moses cone and subsequent ninth circuit cases,we have recognized eight factors for assessing the appropriateness of a colorado river stay or dismissal which court first assumed jurisdiction over any property at stake the inconvenience of the federal forum the desire to avoid piecemeal litigation the order in which the forums obtained jurisdiction whether federal law or state law provides the rule of decision on the merits whether the state court proceedings can adequately protect the rights of the federal litigants the desire to avoid forum shopping and whether the state court proceedings will resolve all issues before the federal court.holder,at 
the first two factors in holder are irrelevant in this case because the dispute does not involve a specific piece of property,and both the federal and state forums are located in los angeles.we discuss each of the remaining six factors below,mindful that a ny doubt as to whether a factor exists should be resolved against a stay or dismissal.travelers,at.as indicated below,some factors may weigh for or against the exercise of jurisdiction while others primarily serve as a bar to stay or dismissal.
piecemeal litigation 
piecemeal litigation occurs when different tribunals consider the same issue,thereby duplicating efforts and possibly reaching different results.am.int l underwriters,philippines,cont l ins,cir.the mere possibility of piecemeal litigation does not constitute an exceptional circumstance.see travelers,at.instead,the case must raise a special concern about piecemeal litigation,which can be remedied by staying or dismissing the federal proceeding.see moses cone,at noting that a stay of the federal suit would not alleviate the possibility that some claims would be subject to arbitration while others were decided in court.
with the removed action in state court,there is no question that maintaining the federal action would result in piecemeal litigation.but it would be improper for a court to stay or dismiss a case based on a possibility of piecemeal adjudication that the court could have avoided by other means.because the district court could have retained jurisdiction over the removed action,the proper inquiry in this case is whether maintaining jurisdiction over the federal action would result in piecemeal litigation even if the removed action were not in state court.like the district court,we conclude that it would.
even if the district court had stayed the removed action,deciding the federal action and the vulcan action in separate courts would result in duplication of efforts.both the vulcan action and the federal action are centered on whether the policy obligates transport to cover damages and defense costs in the tort actions.in colorado river,the court noted that the mccarran amendment evidenced a clear policy of avoiding piecemeal adjudication of water rights in a river system.at.here,there is no explicit policy of avoiding piecemeal adjudication,but like the government in colorado river,street asks the district court to adjudicate rights that are implicated in a vastly more comprehensive state action.travelers,at.the state court consolidated multiple cases to create a comprehensive scheme for deciding coverage in the tort actions.there was a highly interdependent relationship between the claims in the federal action and the claims in the vulcan action,colorado river,at,and although union had not yet brought their claims,the state court contemplated these claims in its plans for proceeding in the vulcan action.the district court did not err by concluding that avoidance of piecemeal litigation weighs significantly against jurisdiction,particularly in light of the next factor.see am.int l underwriters,at upholding a colorado river dismissal,in part to avoid piecemeal litigation.
order of jurisdiction 
we next consider the order in which the forums obtained jurisdiction.as a technical matter,street is correct that the district court was the first to exercise jurisdiction over the specific claims in the federal action.prior to the federal action,vulcan had filed claims against union in the vulcan action,but no claims had been asserted between transport and union.
our analysis does not end here,however.the supreme court has instructed that instead of taking a mechanical approach,courts must apply this factor in a pragmatic,flexible manner with a view to the realities of the case at hand.moses cone,at giving little weight to the dates of filing when the same relative progress had been made in the state and federal proceedings.here,the state court was the first to exercise jurisdiction over the subject matter involved in the federal action.although this might not be relevant in every case,the progress of the vulcan action and union involvement in the vulcan action make this an important consideration in this case.
between the filing of the vulcan action in and the filing of the federal action in,the state court made significant progress in the vulcan action.the court already interpreted the relevant provisions of the policy and was positioned to fully adjudicate the broader coverage dispute between vulcan and transport.the court had conducted discovery,initiated a phased approach to the litigation and issued an order concerning foundational legal matters.in fact,much of this progress occurred after vulcan brought union into the action in.colorado river,at noting the existing participation by the government in similar state court proceedings.additionally,both the parties and the court acknowledged union unlitigated claims against transport,and the state court expressly reserved any decisions regarding these claims for a later phase of the litigation.considering the realities of this case,the district court properly concluded that the state court progress in the vulcan action weighs against jurisdiction.
source of law 
as with most insurance coverage disputes,state law provides the rules of decision for all of union claims,but we consider this a neutral factor here.a lthough the presence of issues must always be a major consideration weighing against surrender of jurisdiction,the presence of issues may weigh in favor of that surrender only in some rare circumstances.travelers,at quoting moses cone,at.this case does not present such rare circumstances.the complexity of the vulcan action and related matters stems from the number of policies and insurers,not from the type of law involved in the action.because the cases here involve routine issues of state law,such as breach of contract,indemnification and subrogation,this factor does not weigh against jurisdiction.see id.concluding the same where the cases involved state law claims for misrepresentation,breach of fiduciary duty and breach of contract.
adequacy of state court 
a district court may not stay or dismiss the federal proceeding if the state proceeding can not adequately protect the rights of the federal litigants.for example,if there is a possibility that the parties will not be able to raise their claims in the state proceeding,a stay or dismissal is inappropriate.see moses cone,at emphasizing that the state court might lack the power to enter the order that the plaintiff was seeking in federal court holder,at noting that the state court probably lacked jurisdiction to hear the plaintiff federal icara claim.
here,there is no question that the state court has authority to address the rights and remedies at issue in this case.in fact,union concede that the state court can adequately resolve the parties claims.like source of law,however,this factor is more important when it weighs in favor of federal jurisdiction.travelers,at internal quotation marks omitted.
forum shopping 
forum shopping refers to t he practice of choosing the most favorable jurisdiction or court in which a claim might be heard.black law dictionary ed.to avoid forum shopping,courts may consider the vexatious or reactive nature of either the federal or the state litigation.moses cone,at.we have affirmed a colorado river stay or dismissal when it was readily apparent that the federal plaintiff was engaged in forum shopping.see nakash marciano,cir plaintiff brought 