compaq computer corporation compaq appeals the orders of the district court granting summary judgment to insurer paul fire and marine insurance company on paul action to recover payments made in defending compaq from a lawsuit and on compaq counterclaim for additional costs of defending that lawsuit.for the reasons discussed below,we affirm the judgment of the district court.
background 
paul provided liability insurance to compaq under a tech e o policy to cover damages arising from any errors and omissions in compaq computer products.errors and omissions were defined to include negligent mistakes but not intentional misconduct.under the tech e o policy,paul had a duty to defend,and a right to control the defense of,any lawsuit against compaq that alleged a covered liability.the policy allowed compaq to take control of the defense of any reported claim only if paul and compaq both agree,or if a court orders compaq to do so.the associated major account services instructions masi agreement between paul and compaq provided additional detail about the right to control the defense of a covered claim,stating that compaq has been given right to select defense counsel subject to stpaul sic right of refusal if refusal is reasonable.selected counsel is subject to stpaul sic retainer agrmnt sic negotiated rates.
in october,the thurmond class action lawsuit was filed against compaq,alleging that compaq was aware,or should have been aware of a technical problem with its floppy disk controllers.in a letter dated november,paul agreed to defend compaq pursuant to the terms and conditions of the tech e o policy but reserved its right to deny liability under the policy upon any subsequent determination that the thurmond claim was not covered.the letter also expressed concern that compaq was retaining defense counsel without paul approval in violation of the terms of the policy and the masi agreement.paul asked for immediate meetings to determine whether paul would agree to allow compaq to maintain their current defense team and control defense.in the alternative,paul offered to refer the matter to defense counsel of paul choice.
on january,paul sent a letter recognizing that compaq had continued to retain three law firms of compaq choice to defend the suit without paul approval.paul stated that the rates charged by those firms were excessive compared to those charged by comparable firms and that compaq employment of three separate firms would likely lead to duplicative work and additional staffing and conferencing costs for interfacing among the three firms.after reiterating its rights under the tech e o policy and the masi agreement to veto compaq choice of defense counsel and to pay no defense costs which were unreasonable or in excess of its approved rates,paul stated its desire to cooperate with compaq to allow compaq to retain its choice of defense counsel.paul offered to consent to compaq chosen defense counsel with the condition that paul would pay only a reduced percentage of compaq defense costs.paul also repeated its earlier reservation of the right to deny all coverage and,in addition,specifically reserved a right to recover any defense costs paid to compaq in the event paul later determined that the claim was not covered.the letter concluded by asking compaq for confirmation that it accepted the offered defense of the thurmond claim.no official acceptance by compaq is documented in the record on appeal,but compaq continued to employ its chosen counsel and began accepting payments from paul in march at a rate of percent of compaq approved defense costs.
on march,the thurmond plaintiffs filed a second amended complaint that set forth in more detail the alleged misconduct by compaq.after reviewing the second and also third amended complaint,paul decided that the thurmond claim alleged only intentional,rather than negligent,misconduct and was,therefore,not covered under the tech e o policy.on september,paul notified compaq that it was withdrawing from compaq defense of the thurmond suit retroactive to march,the date the second amended complaint was filed.however,paul stated that it would continue to review defense fees and expenses incurred in the action prior to march.paul continued to pay percent of compaq approved costs incurred before that date,eventually paying a total of to compaq.
compaq prevailed on summary judgment in the thurmond action on march.in january,compaq sued paul in minnesota state court the action,seeking a declaration of paul duty to defend the thurmond action and damages amounting to any and all costs incurred by compaq in defending the thurmond action.on paul motion to dismiss,the state trial court analyzed the identical language suggesting a negligence claim in the original and five amended thurmond complaints and found that none of the complaints stated a cause of action based in negligence.accordingly,the state trial court found that paul had no duty to defend under the policy.the state trial court also stated that the parties have not raised nor argued the question of whether paul can retroactively withdraw its defense,and the court renders no opinion regarding the same.the minnesota court of appeals affirmed the trial court reasoning in an unpublished opinion,and the minnesota supreme court denied further review.
reading the action result to establish that paul had no duty to defend any of the thurmond complaints,paul filed a subsequent action in minnesota state court to recoup the payments it had made for defense costs incurred prior to the second amended complaint compaq removed the case to federal district court under diversity jurisdiction and counterclaimed for its remaining unpaid defense costs incurred before the second amended complaint.on paul motion to dismiss the counterclaim,converted by the district court to a motion for summary judgment,the district court found that compaq counterclaim for coverage prior to the second amended complaint was barred by the res judicata effect of the action.in a subsequent order,the district court granted summary judgment to paul on its action to recover from compaq the payments it had already made.compaq appeals both orders.
ii.discussion 
we review a grant of summary judgment de novo and apply the same standards as the district court.bockelman mci worldcom,cir.summary judgment is warranted if the evidence,viewed in the light most favorable to the nonmoving party,shows that no genuine issue of material fact exists and that the moving party is entitled to judgment as a matter of law.id.
res judicata 
we agree with the district court that res judicata bars compaq counterclaim for coverage under the policy prior to the second amended complaint.the application of res judicata,or claim preclusion,is reviewed de novo.daley marriott int l,cir the res judicata effect of the first forum judgment is governed by first forum law,in this case minnesota law.austin super valu stores,cir quoting semler psychiatric inst.of washington,see also.under minnesota law,the elements of res judicata are the earlier claim involved the same set of factual circumstances the earlier claim involved the same parties or their privies there was a final judgment on the merits and the estopped party had a full and fair opportunity to litigate the matter.hauschildt beckingham.b ecause res judicata is a flexible doctrine,the focus is on whether its application would work an injustice on the party against whom estoppel is urged.
generally,a ruling on an insurer duty to defend under one version of a complaint does not bar a later suit over the duty to defend under a different version of the complaint if the different version change s the nature of the cause of action alleged or assert s a new or different cause of action bernard gulf ins,see also trust aetna life sur,d.compaq contends that this rule should apply in the instant case,arguing that the action only addressed paul duty to defend after the second amended complaint.in support,compaq notes that paul continued to review and pay percent of compaq approved amended complaint costs during the pendency of the action,giving compaq no reason to sue for those cos