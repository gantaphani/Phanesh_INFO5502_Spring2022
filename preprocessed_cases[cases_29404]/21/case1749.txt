this case raises the issue of whether an otherwise valid waiver of appeal contained in a plea agreement can be enforced against a defendant who contends that his sentence was imposed based upon a constitutionally impermissible consideration.it also involves whether a sentencing judge can impose a longer term of probation on a defendant because of his financial situation and current inability to pay a restitution award.defendant appeals from an order of the united states district court for the southern district of new york owen,affirming a judgment of conviction and sentence following his plea of guilty to one count of bank larceny before magistrate judge frank maas.for the reasons stated below,we affirm.
background 
kevin johnson defendant,a married father of three who worked as a toll collector on the throgs neck bridge,had been in trouble with the law but once,years before.he had pleaded guilty,at the age of,to criminal possession of a weapon in the third degree and was sentenced only to a term of probation.in the summer of,however,an unidentified individual overheard johnson lamenting his lack of funds and inability to pay bills.approaching defendant,this person showed him a check for,issued by the insurance company.the individual claimed that he would give johnson if he could use johnson account to negotiate a similar instrument.when defendant agreed,the person deposited a counterfeit check for in johnson bank account at chase manhattan bank chase,an fdic insured institution.defendant subsequently withdrew the funds,transferring approximately to the other individual and retaining most of the rest himself.
as a result of these activities,johnson was charged with committing bank fraud,in violation of title,united states code,section b.he then entered into a written agreement with the government,consenting to plead guilty to a misdemeanor charge of bank larceny under title,united states code,section b,and stipulating that he would not appeal any sentence set within or below the designated sentencing guidelines range.this range included a potential term of imprisonment of up to six months and a possible fine between and.
the presentence investigation report did not recommend imprisonment but rather three years of probation.it also provided for full restitution of the as mandated by statute.see.at sentencing,magistrate judge maas denied defense counsel request that he reduce this term of probation and instead imposed probation for five years,citing johnson inability to repay the immediately and the resultant need to monitor his effort to furnish restitution.the judge also specified,in response to defendant request,that in the event that full restitution has been made within three years,probation will terminate at the end of the three years emphasis added.the terms of the judgment itself seemingly differ somewhat from the sentencing colloquy,stating that the defendant is hereby placed on probation for a term of five years.the probation officer may recommend minimal supervision after three years.probation may be terminated after three years if restitution has been paid in full emphasis added.aside from a dollar assessment,the judge declined to impose any further fine or imprisonment.
defendant appealed his term of probation to the district court,which affirmed,determining that the period of probation was within the guidelines range,had been properly imposed by the sentencing judge,and fell within the latter discretion under the guidelines.
this appeal followed.
ii.analysis 
waiver of appeal 
the government argues,as a threshold matter,that the terms of johnson plea agreement bar the instant appeal.although johnson did waive his right of appeal,we follow this circuit prior decisions in determining that the agreement does not foreclose johnson from pursuing his constitutional claim.in general,a defendant knowing and voluntary waiver of his right to appeal a sentence within an guidelines range is enforceable.see united states fisher,cir united states,cir.however,we have also held that,when a sentence is based upon a consideration arguably impermissible under the constitution,we will read such an agreement narrowly.united states rosa,noting that we have held that a waiver of the right not to be sentenced on the basis of a constitutionally impermissible factor may be invalid united states jacobson,cir although an agreement not to appeal a sentence within the agreed guidelines range is enforceable,we see nothing in such an agreement that waives the right to appeal from an arguably unconstitutional use of naturalized status as the basis for a sentence.internal citations omitted.we think that the logic of jacobson and rosa applies to the case at hand 
other circuits have concurred in placing limits upon the enforcement and enforceability of waivers of appeal.some have held,for example,that a waiver can not bar a defendant from alleging that ineffective assistance of counsel renders the plea agreement itself invalid.see united states cockerham,cir w e hold that a plea agreement waiver of postconviction rights does not waive the right to bring a habeas petition based on ineffective assistance of counsel claims challenging the validity of the plea or the waiver.united states henderson,cir we agree that dismissal of an appeal based on a waiver in the plea agreement is inappropriate where the defendant motion to withdraw the plea incorporates a claim that the plea agreement generally,and the defendant waiver of appeal specifically,were tainted by ineffective assistance of counsel.
most relevant to this case are those decisions commenting upon potential constitutional problems with sentences meted out pursuant to a plea agreement.in united states marin,cir,the fourth circuit asserted that a defendant who waives his right to appeal does not subject himself to being sentenced entirely at the whim of the district court.for example,a defendant could not be said to have waived his right to appellate review of a sentence based on a constitutionally impermissible factor such as race.id.at see also united states general,cir citing marin and noting that the government had conceded that a waiver did not bar challenges to defendant sentence pursuant to apprendi or on account of his lack of competency,since both were challenges that are not subject to contractual waivers.the eighth circuit also recently reaffirmed its commitment to granting a miscarriage of justice exception to the enforcement of waivers.united states andis,cir en banc.although the court noted that the illegal sentence exception to the general enforceability of an appeal waiver is an extremely narrow exception,id.at,it determined that a sentence allegedly based upon a miscarriage of justice should be reviewed on appeal despite any waiver,id.at,and that release conditions would constitute such a miscarriage of justice if they were based on some constitutionally impermissible factor,such as race.id.at.see also united states khattak,cir stating that,when deciding if a waiver should be enforced,an appellate court guiding consideration should be whether the sentencing error would work a miscarriage of justice.
for these reasons,we determine that where,as here,a defendant alleges that his sentence is constitutionally deficient because it rests improperly upon his status,a plea agreement can not serve to waive his appeal.
probation extension 
johnson contends that the court below,by extending the term of probation to five years on account of his financial situation and current inability to pay restitution,acted inconsistently with the fundamental fairness that the due process clause of the fifth amendment requires.it should be noted at the outset that a defendant financial circumstances are generally irrelevant to sentencing.a district court can,however,take a defendant ability to pay into account in framing a restitution order and setting a payment schedule.see,united states lucien,cir.because probation may be imposed so as to induce a conscientious effort to comply with such a payment schedule,the length of a defendant probation may in some circumstances correlate with his financial means.
johnson const